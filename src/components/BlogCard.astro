---
/**
 * BlogCard Component
 * A card component for displaying blog post previews with featured image,
 * category badge, author info, and reading time.
 *
 * Features:
 * - Featured image with hover effect
 * - Category badge
 * - Author avatar and name
 * - Reading time estimate
 * - Publication date
 * - Excerpt/description
 * - Accessible and responsive design
 * - Dark mode support
 *
 * @example Basic usage
 * ```astro
 * <BlogCard post={blogPost} />
 * ```
 *
 * @example Featured variant
 * ```astro
 * <BlogCard post={blogPost} variant="featured" />
 * ```
 */

import type { BlogCardProps } from '../types/blog';

interface Props extends BlogCardProps {}

const {
  post,
  variant = 'default',
  showCategory = true,
  showAuthor = true,
  showReadingTime = true,
  showDate = true,
  class: className = '',
} = Astro.props;

const { data, slug } = post;

// Format date
const formattedDate = data.pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

// Generate URL-friendly category slug
const categorySlug = data.category.toLowerCase().replace(/\s+/g, '-');

// Build CSS classes
const cardClasses = [
  'blog-card',
  `blog-card--${variant}`,
  data.featured && 'blog-card--featured',
  className,
].filter(Boolean).join(' ');

// Get excerpt (use custom excerpt, description, or truncate content)
const excerpt = data.excerpt || data.description;
---

<article class={cardClasses}>
  <!-- Image Container -->
  <a href={`/blog/${slug}`} class="blog-card__image-link" tabindex="-1" aria-hidden="true">
    <div class="blog-card__image-container">
      {data.featuredImage ? (
        <img
          src={data.featuredImage.src}
          alt={data.featuredImage.alt}
          width={data.featuredImage.width || 600}
          height={data.featuredImage.height || 400}
          loading="lazy"
          decoding="async"
          class="blog-card__image"
        />
      ) : (
        <div class="blog-card__image-placeholder">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="blog-card__placeholder-icon"
            aria-hidden="true"
          >
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
        </div>
      )}

      {/* Category Badge */}
      {showCategory && (
        <span class="blog-card__category-badge">
          {data.category}
        </span>
      )}
    </div>
  </a>

  <!-- Content -->
  <div class="blog-card__content">
    {/* Meta Info */}
    <div class="blog-card__meta">
      {showDate && (
        <time class="blog-card__date" datetime={data.pubDate.toISOString()}>
          {formattedDate}
        </time>
      )}
      {showDate && showReadingTime && data.readingTime && (
        <span class="blog-card__meta-separator" aria-hidden="true">Â·</span>
      )}
      {showReadingTime && data.readingTime && (
        <span class="blog-card__reading-time">
          {data.readingTime} min read
        </span>
      )}
    </div>

    {/* Title */}
    <h3 class="blog-card__title">
      <a href={`/blog/${slug}`} class="blog-card__title-link">
        {data.title}
      </a>
    </h3>

    {/* Excerpt */}
    <p class="blog-card__excerpt">{excerpt}</p>

    {/* Author */}
    {showAuthor && data.author && (
      <div class="blog-card__author">
        {data.author.avatar && (
          <img
            src={data.author.avatar}
            alt=""
            width="32"
            height="32"
            class="blog-card__author-avatar"
            loading="lazy"
          />
        )}
        <span class="blog-card__author-name">{data.author.name}</span>
      </div>
    )}

    {/* Tags */}
    {data.tags && data.tags.length > 0 && variant !== 'compact' && (
      <div class="blog-card__tags">
        {data.tags.slice(0, 3).map((tag) => (
          <span class="blog-card__tag">#{tag}</span>
        ))}
      </div>
    )}
  </div>
</article>

<style>
  /* =================================================================
   * BLOG CARD COMPONENT STYLES
   * =================================================================
   * Uses design system variables from variables.css
   * Follows BEM naming convention for maintainability
   */

  .blog-card {
    /* Layout */
    display: flex;
    flex-direction: column;
    height: 100%;

    /* Visual */
    background-color: var(--color-background-elevated);
    border-radius: var(--radius-lg);
    overflow: hidden;

    /* Animation */
    transition:
      box-shadow var(--duration-300) var(--ease-out),
      transform var(--duration-300) var(--ease-out);
  }

  .blog-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-4px);
  }

  .blog-card--featured {
    box-shadow: var(--shadow-md);
  }

  /* =================================================================
   * IMAGE CONTAINER
   * ================================================================= */
  .blog-card__image-link {
    display: block;
    text-decoration: none;
  }

  .blog-card__image-container {
    position: relative;
    aspect-ratio: 16 / 10;
    overflow: hidden;
    background-color: var(--color-background-muted);
  }

  .blog-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transition: transform var(--duration-500) var(--ease-out);
  }

  .blog-card:hover .blog-card__image {
    transform: scale(1.05);
  }

  .blog-card__image-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    background-color: var(--color-background-muted);
    color: var(--color-text-tertiary);
  }

  .blog-card__placeholder-icon {
    width: 48px;
    height: 48px;
    opacity: 0.5;
  }

  /* =================================================================
   * CATEGORY BADGE
   * ================================================================= */
  .blog-card__category-badge {
    position: absolute;
    top: var(--spacing-3);
    left: var(--spacing-3);
    padding: var(--spacing-1) var(--spacing-2-5);
    background-color: var(--color-primary);
    color: var(--color-text-inverse);
    font-family: var(--font-body);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-wide);
    border-radius: var(--radius-sm);
  }

  /* =================================================================
   * CONTENT AREA
   * ================================================================= */
  .blog-card__content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
    padding: var(--spacing-5);
    flex: 1;
  }

  /* =================================================================
   * META INFO
   * ================================================================= */
  .blog-card__meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-text-tertiary);
  }

  .blog-card__date {
    color: var(--color-text-tertiary);
  }

  .blog-card__meta-separator {
    color: var(--color-text-tertiary);
  }

  .blog-card__reading-time {
    color: var(--color-text-tertiary);
  }

  /* =================================================================
   * TITLE
   * ================================================================= */
  .blog-card__title {
    margin: 0;
    font-family: var(--font-heading);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    line-height: var(--line-height-snug);
    color: var(--color-text-primary);
  }

  .blog-card__title-link {
    color: inherit;
    text-decoration: none;
    transition: color var(--duration-150) var(--ease-in-out);
  }

  .blog-card__title-link:hover {
    color: var(--color-primary);
  }

  .blog-card__title-link:focus-visible {
    outline: none;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  /* =================================================================
   * EXCERPT
   * ================================================================= */
  .blog-card__excerpt {
    margin: 0;
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);

    /* Limit to 3 lines */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* =================================================================
   * AUTHOR
   * ================================================================= */
  .blog-card__author {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    margin-top: auto;
    padding-top: var(--spacing-3);
  }

  .blog-card__author-avatar {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-full);
    object-fit: cover;
    background-color: var(--color-background-muted);
  }

  .blog-card__author-name {
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
  }

  /* =================================================================
   * TAGS
   * ================================================================= */
  .blog-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-2);
    margin-top: var(--spacing-2);
  }

  .blog-card__tag {
    font-family: var(--font-body);
    font-size: var(--font-size-xs);
    color: var(--color-text-tertiary);
  }

  /* =================================================================
   * VARIANT: FEATURED
   * ================================================================= */
  .blog-card--featured .blog-card__image-container {
    aspect-ratio: 16 / 9;
  }

  .blog-card--featured .blog-card__title {
    font-size: var(--font-size-xl);
  }

  .blog-card--featured .blog-card__excerpt {
    -webkit-line-clamp: 4;
  }

  /* =================================================================
   * VARIANT: COMPACT
   * ================================================================= */
  .blog-card--compact {
    flex-direction: row;
  }

  .blog-card--compact .blog-card__image-container {
    width: 120px;
    min-width: 120px;
    aspect-ratio: 1;
  }

  .blog-card--compact .blog-card__content {
    padding: var(--spacing-3);
  }

  .blog-card--compact .blog-card__title {
    font-size: var(--font-size-base);
  }

  .blog-card--compact .blog-card__excerpt {
    -webkit-line-clamp: 2;
  }

  .blog-card--compact .blog-card__author {
    display: none;
  }

  /* =================================================================
   * RESPONSIVE STYLES
   * ================================================================= */
  @media screen and (max-width: 767px) {
    .blog-card__content {
      padding: var(--spacing-4);
    }

    .blog-card__title {
      font-size: var(--font-size-base);
    }

    .blog-card--featured .blog-card__title {
      font-size: var(--font-size-lg);
    }

    .blog-card--compact {
      flex-direction: column;
    }

    .blog-card--compact .blog-card__image-container {
      width: 100%;
      aspect-ratio: 16 / 10;
    }
  }

  /* =================================================================
   * REDUCED MOTION
   * ================================================================= */
  @media (prefers-reduced-motion: reduce) {
    .blog-card,
    .blog-card__image,
    .blog-card__title-link {
      transition: none;
    }

    .blog-card:hover {
      transform: none;
    }

    .blog-card:hover .blog-card__image {
      transform: none;
    }
  }

  /* =================================================================
   * DARK MODE
   * ================================================================= */
  :global(html[data-theme="dark"]) .blog-card {
    background-color: var(--color-background-elevated);
  }

  /* =================================================================
   * HIGH CONTRAST MODE
   * ================================================================= */
  @media (forced-colors: active) {
    .blog-card {
      border: 2px solid currentColor;
    }

    .blog-card__category-badge {
      border: 1px solid currentColor;
    }
  }

  /* =================================================================
   * PRINT STYLES
   * ================================================================= */
  @media print {
    .blog-card {
      box-shadow: none;
      border: 1px solid var(--color-border);
      break-inside: avoid;
      page-break-inside: avoid;
    }

    .blog-card:hover {
      transform: none;
      box-shadow: none;
    }
  }
</style>
