---
/**
 * ImageGallerySkeleton Component
 * A skeleton loading placeholder for image galleries on product detail pages.
 * Provides visual feedback during content loading with shimmer animation.
 *
 * Features:
 * - Main image placeholder with shimmer animation
 * - Thumbnail placeholders (optional)
 * - Configurable aspect ratio
 * - Full accessibility support
 * - Reduced motion support
 * - Dark mode support
 *
 * @example Basic usage
 * ```astro
 * <ImageGallerySkeleton />
 * ```
 *
 * @example With custom thumbnail count
 * ```astro
 * <ImageGallerySkeleton thumbnailCount={4} />
 * ```
 *
 * @example Square aspect ratio
 * ```astro
 * <ImageGallerySkeleton aspectRatio="1:1" />
 * ```
 */

interface Props {
  /** Aspect ratio for the main image placeholder */
  aspectRatio?: '4:5' | '1:1' | '3:4' | '16:9';
  /** Number of thumbnail placeholders to show */
  thumbnailCount?: number;
  /** Whether to show thumbnail placeholders */
  showThumbnails?: boolean;
  /** Whether to animate the skeleton */
  animate?: boolean;
  /** Additional CSS classes */
  class?: string;
}

const {
  aspectRatio = '4:5',
  thumbnailCount = 4,
  showThumbnails = true,
  animate = true,
  class: className = '',
} = Astro.props;

// Calculate aspect ratio CSS value
const aspectRatioMap: Record<string, string> = {
  '4:5': '4 / 5',
  '1:1': '1 / 1',
  '3:4': '3 / 4',
  '16:9': '16 / 9',
};
const aspectRatioCss = aspectRatioMap[aspectRatio] || '4 / 5';

// Build CSS classes
const skeletonClasses = [
  'image-gallery-skeleton',
  animate && 'image-gallery-skeleton--animated',
  className,
].filter(Boolean).join(' ');

// Create array for thumbnails
const thumbnails = Array.from({ length: thumbnailCount }, (_, index) => index);
---

<div
  class={skeletonClasses}
  aria-hidden="true"
  role="presentation"
  aria-label="Loading images"
  style={`--gallery-aspect-ratio: ${aspectRatioCss};`}
>
  <!-- Main Image Placeholder -->
  <div class="image-gallery-skeleton__main">
    <div class="image-gallery-skeleton__shimmer"></div>
  </div>

  <!-- Thumbnails Placeholder -->
  {showThumbnails && (
    <div class="image-gallery-skeleton__thumbnails">
      {thumbnails.map((index) => (
        <div
          class="image-gallery-skeleton__thumbnail"
          style={animate ? `--stagger-delay: ${index * 50}ms` : ''}
        >
          <div class="image-gallery-skeleton__shimmer"></div>
        </div>
      ))}
    </div>
  )}
</div>

<style>
  /* =================================================================
   * IMAGE GALLERY SKELETON STYLES
   * =================================================================
   * Skeleton loading placeholder for product image galleries
   * Uses design system variables for consistency
   */

  .image-gallery-skeleton {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
  }

  /* =================================================================
   * MAIN IMAGE
   * ================================================================= */
  .image-gallery-skeleton__main {
    position: relative;
    aspect-ratio: var(--gallery-aspect-ratio, 4 / 5);
    background-color: var(--color-background-muted);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }

  /* =================================================================
   * THUMBNAILS
   * ================================================================= */
  .image-gallery-skeleton__thumbnails {
    display: flex;
    gap: var(--spacing-3);
    overflow-x: auto;
    padding-bottom: var(--spacing-2);
  }

  .image-gallery-skeleton__thumbnail {
    position: relative;
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    background-color: var(--color-background-muted);
    border-radius: var(--radius-md);
    overflow: hidden;
  }

  /* =================================================================
   * SHIMMER ANIMATION
   * ================================================================= */
  .image-gallery-skeleton__shimmer {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(--color-background-subtle) 50%,
      transparent 100%
    );
    background-size: 200% 100%;
  }

  .image-gallery-skeleton--animated .image-gallery-skeleton__shimmer {
    animation: skeleton-shimmer 1.5s ease-in-out infinite;
  }

  /* Stagger thumbnails */
  .image-gallery-skeleton--animated .image-gallery-skeleton__thumbnail {
    opacity: 0;
    animation: skeleton-fade-in 0.3s ease-out forwards;
    animation-delay: var(--stagger-delay, 0ms);
  }

  @keyframes skeleton-shimmer {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  @keyframes skeleton-fade-in {
    to {
      opacity: 1;
    }
  }

  /* =================================================================
   * RESPONSIVE STYLES
   * ================================================================= */
  @media screen and (max-width: 767px) {
    .image-gallery-skeleton__thumbnails {
      gap: var(--spacing-2);
    }

    .image-gallery-skeleton__thumbnail {
      width: 60px;
      height: 60px;
    }
  }

  /* =================================================================
   * REDUCED MOTION
   * ================================================================= */
  @media (prefers-reduced-motion: reduce) {
    .image-gallery-skeleton--animated .image-gallery-skeleton__shimmer {
      animation: none;
    }

    .image-gallery-skeleton--animated .image-gallery-skeleton__thumbnail {
      opacity: 1;
      animation: none;
    }
  }

  /* =================================================================
   * DARK MODE
   * ================================================================= */
  :global(html[data-theme="dark"]) .image-gallery-skeleton__main,
  :global(html[data-theme="dark"]) .image-gallery-skeleton__thumbnail {
    background-color: var(--color-background-muted);
  }

  :global(html[data-theme="dark"]) .image-gallery-skeleton__shimmer {
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(--color-background-elevated) 50%,
      transparent 100%
    );
    background-size: 200% 100%;
  }

  /* =================================================================
   * HIGH CONTRAST MODE
   * ================================================================= */
  @media (forced-colors: active) {
    .image-gallery-skeleton__main,
    .image-gallery-skeleton__thumbnail {
      border: 2px solid currentColor;
    }

    .image-gallery-skeleton__shimmer {
      display: none;
    }
  }
</style>
