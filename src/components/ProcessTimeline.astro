---
/**
 * ProcessTimeline Component
 * A visual timeline component that displays the typical project workflow
 * from start to finish with phases, descriptions, and timeframes.
 *
 * Features:
 * - Vertical timeline with phase icons
 * - Clear phase titles and descriptions
 * - Approximate timeframes for each phase
 * - Client involvement indicators
 * - Responsive design with proper spacing
 * - Accessible with semantic HTML
 *
 * @example Basic usage
 * ```astro
 * <ProcessTimeline
 *   phases={[
 *     {
 *       name: "Discovery",
 *       description: "We learn about your business and goals.",
 *       duration: "1-2 days",
 *       icon: "search"
 *     },
 *     ...
 *   ]}
 * />
 * ```
 */

export interface ProcessPhase {
  /** Name of the phase */
  name: string;
  /** Description of what happens in this phase */
  description: string;
  /** Approximate duration (e.g., "1-2 days", "1 week") */
  duration: string;
  /** Client involvement level (optional) */
  clientInvolvement?: 'High' | 'Medium' | 'Low';
  /** Phase icon (will use default icons based on common phases) */
  icon?: string;
}

export interface ProcessTimelineProps {
  /** List of process phases to display */
  phases: ProcessPhase[];
  /** Section heading */
  heading?: string;
  /** Section subheading/description */
  subheading?: string;
  /** Additional CSS classes */
  class?: string;
}

interface Props extends ProcessTimelineProps {}

const {
  phases,
  heading = 'Our Process',
  subheading = 'A clear, transparent workflow that keeps you informed every step of the way.',
  class: className = '',
} = Astro.props;

const sectionClasses = [
  'process-section',
  className,
].filter(Boolean).join(' ');

// Default icons for common phases
const defaultIcons: Record<string, string> = {
  discovery: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>`,
  design: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>`,
  development: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>`,
  review: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>`,
  launch: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71L12 2zm0 3.79L16.26 16.2 12 14.6l-4.26 1.6L12 5.79z"/></svg>`,
  support: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>`,
  default: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>`,
};

// Get icon for a phase
function getPhaseIcon(phase: ProcessPhase): string {
  if (phase.icon) return phase.icon;
  const phaseName = phase.name.toLowerCase();
  return defaultIcons[phaseName] || defaultIcons.default;
}

// Get client involvement color class
function getInvolvementClass(level?: string): string {
  switch (level?.toLowerCase()) {
    case 'high': return 'process-phase__involvement--high';
    case 'medium': return 'process-phase__involvement--medium';
    case 'low': return 'process-phase__involvement--low';
    default: return '';
  }
}
---

<section class={sectionClasses}>
  <header class="process-section__header">
    <h2 class="process-section__heading">{heading}</h2>
    {subheading && <p class="process-section__subheading">{subheading}</p>}
  </header>

  <div class="process-timeline" role="list" aria-label="Project process timeline">
    {phases.map((phase, index) => (
      <article
        class="process-phase"
        role="listitem"
        style={`--phase-index: ${index}`}
      >
        <div class="process-phase__connector" aria-hidden="true">
          <div class="process-phase__line"></div>
          <div class="process-phase__icon-wrapper">
            <span class="process-phase__number">{index + 1}</span>
          </div>
          {index < phases.length - 1 && <div class="process-phase__line process-phase__line--bottom"></div>}
        </div>

        <div class="process-phase__content">
          <div class="process-phase__header">
            <h3 class="process-phase__name">{phase.name}</h3>
            <span class="process-phase__duration">
              <svg class="process-phase__duration-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
              </svg>
              {phase.duration}
            </span>
          </div>

          <p class="process-phase__description">{phase.description}</p>

          {phase.clientInvolvement && (
            <div class={`process-phase__involvement ${getInvolvementClass(phase.clientInvolvement)}`}>
              <span class="process-phase__involvement-label">Your involvement:</span>
              <span class="process-phase__involvement-level">{phase.clientInvolvement}</span>
            </div>
          )}
        </div>
      </article>
    ))}
  </div>
</section>

<style>
  /* =================================================================
   * PROCESS TIMELINE COMPONENT STYLES
   * =================================================================
   * Uses design system variables from variables.css
   * Follows BEM naming convention for maintainability
   */

  .process-section {
    width: 100%;
  }

  /* Section Header */
  .process-section__header {
    text-align: center;
    margin-bottom: var(--spacing-12);
  }

  .process-section__heading {
    font-family: var(--font-heading);
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    margin: 0 0 var(--spacing-3) 0;
    line-height: var(--line-height-tight);
  }

  .process-section__subheading {
    font-family: var(--font-body);
    font-size: var(--font-size-md);
    color: var(--color-text-secondary);
    margin: 0;
    max-width: 60ch;
    margin-left: auto;
    margin-right: auto;
    line-height: var(--line-height-relaxed);
  }

  /* =================================================================
   * TIMELINE STYLES
   * ================================================================= */

  .process-timeline {
    display: flex;
    flex-direction: column;
    max-width: 700px;
    margin: 0 auto;
  }

  .process-phase {
    display: flex;
    gap: var(--spacing-4);
    animation: fadeInPhase 0.5s ease-out calc(var(--phase-index) * 0.15s) backwards;
  }

  /* Connector (line and icon) */
  .process-phase__connector {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex-shrink: 0;
    width: 40px;
  }

  .process-phase__line {
    width: 2px;
    flex: 1;
    background: linear-gradient(
      to bottom,
      var(--color-primary-200),
      var(--color-primary-300)
    );
    min-height: var(--spacing-4);
  }

  .process-phase:first-child .process-phase__line:first-child {
    background: transparent;
  }

  .process-phase__line--bottom {
    min-height: var(--spacing-6);
  }

  .process-phase__icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-600) 100%);
    border-radius: var(--radius-full);
    color: var(--color-text-inverse);
    box-shadow: var(--shadow-md), 0 0 0 4px var(--color-primary-50);
    flex-shrink: 0;
    transition: transform var(--duration-200) var(--ease-in-out);
  }

  .process-phase:hover .process-phase__icon-wrapper {
    transform: scale(1.1);
  }

  .process-phase__number {
    font-family: var(--font-heading);
    font-size: var(--font-size-md);
    font-weight: var(--font-weight-bold);
  }

  .process-phase__icon {
    width: 20px;
    height: 20px;
  }

  .process-phase__icon :global(svg) {
    width: 100%;
    height: 100%;
  }

  /* Content */
  .process-phase__content {
    flex: 1;
    padding-bottom: var(--spacing-8);
    padding-top: var(--spacing-1);
  }

  .process-phase:last-child .process-phase__content {
    padding-bottom: 0;
  }

  .process-phase__header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--spacing-3);
    margin-bottom: var(--spacing-2);
  }

  .process-phase__name {
    font-family: var(--font-heading);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin: 0;
    line-height: var(--line-height-tight);
  }

  .process-phase__duration {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-primary);
    font-weight: var(--font-weight-medium);
    background-color: var(--color-primary-50);
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-full);
  }

  .process-phase__duration-icon {
    width: 14px;
    height: 14px;
  }

  .process-phase__description {
    font-family: var(--font-body);
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
    margin: 0 0 var(--spacing-3) 0;
  }

  /* Client Involvement Badge */
  .process-phase__involvement {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-2);
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    padding: var(--spacing-1) var(--spacing-3);
    border-radius: var(--radius-lg);
    background-color: var(--color-background-muted);
  }

  .process-phase__involvement-label {
    color: var(--color-text-tertiary);
  }

  .process-phase__involvement-level {
    font-weight: var(--font-weight-semibold);
  }

  .process-phase__involvement--high .process-phase__involvement-level {
    color: var(--color-success-dark);
  }

  .process-phase__involvement--medium .process-phase__involvement-level {
    color: var(--color-warning-dark);
  }

  .process-phase__involvement--low .process-phase__involvement-level {
    color: var(--color-info-dark);
  }

  /* =================================================================
   * ANIMATIONS
   * ================================================================= */

  @keyframes fadeInPhase {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* =================================================================
   * RESPONSIVE STYLES
   * ================================================================= */

  /* Tablet and up (768px) */
  @media screen and (min-width: 768px) {
    .process-section__heading {
      font-size: var(--font-size-3xl);
    }

    .process-phase {
      gap: var(--spacing-6);
    }

    .process-phase__connector {
      width: 48px;
    }

    .process-phase__icon-wrapper {
      width: 48px;
      height: 48px;
    }

    .process-phase__number {
      font-size: var(--font-size-lg);
    }

    .process-phase__name {
      font-size: var(--font-size-xl);
    }

    .process-phase__content {
      padding-bottom: var(--spacing-10);
    }
  }

  /* Desktop (1024px) */
  @media screen and (min-width: 1024px) {
    .process-timeline {
      max-width: 800px;
    }
  }

  /* =================================================================
   * REDUCED MOTION
   * ================================================================= */

  @media (prefers-reduced-motion: reduce) {
    .process-phase {
      animation: none;
    }

    .process-phase:hover .process-phase__icon-wrapper {
      transform: none;
    }
  }

  /* =================================================================
   * HIGH CONTRAST MODE
   * ================================================================= */

  @media (forced-colors: active) {
    .process-phase__icon-wrapper {
      background: Highlight;
      color: HighlightText;
      border: 2px solid CanvasText;
    }

    .process-phase__line {
      background: CanvasText;
    }

    .process-phase__duration,
    .process-phase__involvement {
      border: 1px solid CanvasText;
    }
  }

  /* =================================================================
   * PRINT STYLES
   * ================================================================= */

  @media print {
    .process-phase {
      animation: none;
      break-inside: avoid;
      page-break-inside: avoid;
    }

    .process-phase__icon-wrapper {
      background: var(--color-primary);
      print-color-adjust: exact;
      -webkit-print-color-adjust: exact;
    }

    .process-phase__line {
      background: var(--color-border-dark);
    }
  }
</style>
