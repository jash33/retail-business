---
/**
 * PricingCard Component
 * A card component for displaying pricing tier information with features list,
 * pricing, and call-to-action button.
 *
 * Features:
 * - Visual hierarchy with highlighted/recommended tier
 * - Clear pricing display
 * - Feature checklist with icons
 * - CTA button for each tier
 * - Hover animations and accessibility support
 * - Responsive design
 *
 * @example Basic usage
 * ```astro
 * <PricingCard
 *   id="starter"
 *   name="Starter"
 *   price="$800"
 *   description="Perfect for small businesses just getting started online."
 *   features={["Custom design", "Mobile responsive", "Basic SEO"]}
 *   cta={{ text: "Get Started", href: "/contact" }}
 * />
 * ```
 *
 * @example Highlighted tier
 * ```astro
 * <PricingCard
 *   id="professional"
 *   name="Professional"
 *   price="$1,500"
 *   isPopular={true}
 *   popularLabel="Most Popular"
 *   ...
 * />
 * ```
 */

import Button from './Button.astro';

export interface PricingCardProps {
  /** Unique identifier for the tier */
  id: string;
  /** Name of the pricing tier */
  name: string;
  /** Price display (e.g., "$800", "$2,500+", "Custom") */
  price: string;
  /** Optional price note (e.g., "starting at", "one-time") */
  priceNote?: string;
  /** Brief description of what this tier includes */
  description: string;
  /** List of features included in this tier */
  features: string[];
  /** Optional list of features NOT included (shown with X icon) */
  excludedFeatures?: string[];
  /** Call-to-action button configuration */
  cta: {
    text: string;
    href: string;
    openInNewTab?: boolean;
  };
  /** Whether this tier is highlighted as popular/recommended */
  isPopular?: boolean;
  /** Custom label for popular badge (default: "Most Popular") */
  popularLabel?: string;
  /** Additional CSS classes */
  class?: string;
}

interface Props extends PricingCardProps {}

const {
  id,
  name,
  price,
  priceNote,
  description,
  features,
  excludedFeatures = [],
  cta,
  isPopular = false,
  popularLabel = 'Most Popular',
  class: className = '',
} = Astro.props;

// Build CSS classes
const cardClasses = [
  'pricing-card',
  isPopular && 'pricing-card--popular',
  className,
].filter(Boolean).join(' ');

// Check icon SVG
const checkIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>`;

// X icon SVG for excluded features
const xIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>`;
---

<article class={cardClasses} id={`pricing-${id}`}>
  {isPopular && (
    <div class="pricing-card__badge">
      <span class="pricing-card__badge-text">{popularLabel}</span>
    </div>
  )}

  <header class="pricing-card__header">
    <h3 class="pricing-card__name">{name}</h3>
    <div class="pricing-card__price-wrapper">
      {priceNote && <span class="pricing-card__price-note">{priceNote}</span>}
      <p class="pricing-card__price">{price}</p>
    </div>
    <p class="pricing-card__description">{description}</p>
  </header>

  <div class="pricing-card__features">
    <h4 class="pricing-card__features-title">What's Included:</h4>
    <ul class="pricing-card__features-list" role="list">
      {features.map((feature) => (
        <li class="pricing-card__feature pricing-card__feature--included">
          <span class="pricing-card__feature-icon" set:html={checkIcon} />
          <span class="pricing-card__feature-text">{feature}</span>
        </li>
      ))}
      {excludedFeatures.map((feature) => (
        <li class="pricing-card__feature pricing-card__feature--excluded">
          <span class="pricing-card__feature-icon pricing-card__feature-icon--excluded" set:html={xIcon} />
          <span class="pricing-card__feature-text">{feature}</span>
        </li>
      ))}
    </ul>
  </div>

  <footer class="pricing-card__footer">
    <Button
      text={cta.text}
      href={cta.href}
      variant={isPopular ? 'primary' : 'secondary'}
      size="medium"
      fullWidth={true}
      openInNewTab={cta.openInNewTab}
      class="pricing-card__cta"
    />
  </footer>
</article>

<style>
  /* =================================================================
   * PRICING CARD COMPONENT STYLES
   * =================================================================
   * Uses design system variables from variables.css
   * Follows BEM naming convention for maintainability
   */

  .pricing-card {
    /* Layout */
    display: flex;
    flex-direction: column;
    position: relative;

    /* Box model */
    padding: var(--spacing-6);

    /* Visual */
    background-color: var(--color-background-elevated);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-sm);

    /* Animation */
    transition:
      box-shadow var(--duration-200) var(--ease-in-out),
      transform var(--duration-200) var(--ease-in-out),
      border-color var(--duration-200) var(--ease-in-out);
  }

  .pricing-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-4px);
  }

  /* Popular/Highlighted Tier */
  .pricing-card--popular {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md), 0 0 0 1px var(--color-primary-200);
  }

  .pricing-card--popular:hover {
    box-shadow: var(--shadow-xl), 0 0 0 1px var(--color-primary-300);
  }

  /* Popular Badge */
  .pricing-card__badge {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-600) 100%);
    color: var(--color-text-inverse);
    padding: var(--spacing-1-5) var(--spacing-4);
    border-radius: var(--radius-full);
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    letter-spacing: var(--letter-spacing-wide);
    text-transform: uppercase;
    box-shadow: var(--shadow-md);
    white-space: nowrap;
  }

  /* Header Section */
  .pricing-card__header {
    text-align: center;
    padding-bottom: var(--spacing-6);
    border-bottom: 1px solid var(--color-border);
    margin-bottom: var(--spacing-6);
  }

  .pricing-card--popular .pricing-card__header {
    padding-top: var(--spacing-4);
  }

  .pricing-card__name {
    font-family: var(--font-heading);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin: 0 0 var(--spacing-4) 0;
    line-height: var(--line-height-tight);
  }

  .pricing-card__price-wrapper {
    margin-bottom: var(--spacing-3);
  }

  .pricing-card__price-note {
    display: block;
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-text-tertiary);
    margin-bottom: var(--spacing-1);
  }

  .pricing-card__price {
    font-family: var(--font-heading);
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    margin: 0;
    line-height: var(--line-height-none);
  }

  .pricing-card--popular .pricing-card__price {
    color: var(--color-primary-700);
  }

  .pricing-card__description {
    font-family: var(--font-body);
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
    margin: 0;
  }

  /* Features Section */
  .pricing-card__features {
    flex: 1;
    margin-bottom: var(--spacing-6);
  }

  .pricing-card__features-title {
    font-family: var(--font-heading);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-tertiary);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-wider);
    margin: 0 0 var(--spacing-4) 0;
  }

  .pricing-card__features-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-3);
  }

  .pricing-card__feature {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-3);
    font-family: var(--font-body);
    font-size: var(--font-size-base);
    line-height: var(--line-height-snug);
  }

  .pricing-card__feature--included {
    color: var(--color-text-secondary);
  }

  .pricing-card__feature--excluded {
    color: var(--color-text-disabled);
  }

  .pricing-card__feature-icon {
    flex-shrink: 0;
    width: 1.25rem;
    height: 1.25rem;
    margin-top: 0.125rem;
  }

  .pricing-card__feature--included .pricing-card__feature-icon {
    color: var(--color-success);
  }

  .pricing-card__feature-icon--excluded {
    color: var(--color-text-disabled);
  }

  .pricing-card__feature-icon :global(svg) {
    width: 100%;
    height: 100%;
  }

  .pricing-card__feature-text {
    flex: 1;
  }

  /* Footer with CTA */
  .pricing-card__footer {
    margin-top: auto;
  }

  /* =================================================================
   * RESPONSIVE STYLES
   * ================================================================= */

  /* Tablet and up (768px) */
  @media screen and (min-width: 768px) {
    .pricing-card {
      padding: var(--spacing-8);
    }

    .pricing-card__name {
      font-size: var(--font-size-2xl);
    }

    .pricing-card__price {
      font-size: var(--font-size-5xl);
    }

    .pricing-card__header {
      padding-bottom: var(--spacing-8);
      margin-bottom: var(--spacing-8);
    }
  }

  /* =================================================================
   * REDUCED MOTION
   * Respect user preferences for reduced motion
   * ================================================================= */
  @media (prefers-reduced-motion: reduce) {
    .pricing-card {
      transition: none;
    }

    .pricing-card:hover {
      transform: none;
    }
  }

  /* =================================================================
   * HIGH CONTRAST MODE
   * ================================================================= */
  @media (forced-colors: active) {
    .pricing-card {
      border: 2px solid CanvasText;
    }

    .pricing-card--popular {
      border-width: 3px;
    }

    .pricing-card__badge {
      background: Highlight;
      color: HighlightText;
    }

    .pricing-card__feature-icon {
      forced-color-adjust: none;
    }
  }

  /* =================================================================
   * PRINT STYLES
   * ================================================================= */
  @media print {
    .pricing-card {
      box-shadow: none;
      border: 1px solid var(--color-border);
      break-inside: avoid;
      page-break-inside: avoid;
    }

    .pricing-card:hover {
      transform: none;
      box-shadow: none;
    }

    .pricing-card__badge {
      background: var(--color-primary);
      print-color-adjust: exact;
      -webkit-print-color-adjust: exact;
    }

    .pricing-card__footer {
      display: none;
    }
  }
</style>
