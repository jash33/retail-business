---
/**
 * Base Layout Component
 * Provides the HTML structure and SEO configuration for all pages.
 * Includes performance optimizations and privacy-compliant analytics.
 *
 * @example
 * ```astro
 * <Layout
 *   title="Page Title"
 *   description="Page description for SEO"
 * >
 *   <main>Page content here</main>
 * </Layout>
 * ```
 */

// Import global styles including design system variables
import '../styles/globals.css';

import SEO from '../components/SEO.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import GoogleAnalytics from '../components/GoogleAnalytics.astro';
import CookieConsent from '../components/CookieConsent.astro';
import PerformanceMonitor from '../components/PerformanceMonitor.astro';
import type { SEOProps } from '../types/seo';
import { seoConfig } from '../config/seo.config';

// Extend SEOProps but make title and description optional with defaults
interface Props extends Partial<SEOProps> {
  /** Page title (defaults to site name) */
  title?: string;
  /** Page description (defaults to site default description) */
  description?: string;
  /** Additional classes for the body element */
  bodyClass?: string;
  /** Disable analytics for this page */
  disableAnalytics?: boolean;
}

const {
  title = seoConfig.siteName,
  description = seoConfig.defaultDescription,
  bodyClass = '',
  lang = seoConfig.defaultLang,
  disableAnalytics = false,
  ...seoProps
} = Astro.props;
---

<!doctype html>
<html lang={lang}>
	<head>
		<!-- Charset must be within first 1024 bytes -->
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<!-- Preconnect to external resources for performance -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

		<!-- DNS prefetch for analytics (loaded conditionally) -->
		<link rel="dns-prefetch" href="https://www.googletagmanager.com" />

		<SEO
			title={title}
			description={description}
			{...seoProps}
		/>

		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />

		<!-- Google Analytics 4 (consent-based) -->
		{!disableAnalytics && <GoogleAnalytics />}

		<!-- Slot for additional head content -->
		<slot name="head" />
	</head>
	<body class={bodyClass}>
		<a href="#main-content" class="skip-link">Skip to main content</a>
		<Header currentPath={Astro.url.pathname} />
		<div id="main-content">
			<slot />
		</div>
		<Footer />

		<!-- Cookie Consent Banner (GDPR/CCPA compliant) -->
		{!disableAnalytics && <CookieConsent />}

		<!-- Performance Monitoring (Core Web Vitals) -->
		{!disableAnalytics && <PerformanceMonitor />}
	</body>
</html>

<style>
	html,
	body {
		width: 100%;
		height: 100%;
	}

	/* Sticky footer layout using flexbox */
	body {
		display: flex;
		flex-direction: column;
		min-height: 100vh;
	}

	#main-content {
		flex: 1 0 auto;
	}
</style>
