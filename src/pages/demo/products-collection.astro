---
/**
 * Demo Page - Product Content Collections
 * Demonstrates the Astro Content Collections integration for products
 */

import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';
import {
  getAllProducts,
  getFeaturedProducts,
  getProductsByCategory,
  toProductCardProps,
  sortProducts,
} from '../../utils/products';

// Fetch products from the content collection
const allProducts = await getAllProducts();
const featuredProducts = await getFeaturedProducts();
const kitchenProducts = await getProductsByCategory('Kitchen');

// Sort all products by priority
const sortedProducts = sortProducts(allProducts, 'priority');
---

<Layout title="Product Collections Demo | Houston Web Services">
  <main class="demo-page" data-testid="products-collection-demo">
    <section class="demo-header">
      <div class="demo-container">
        <h1>Product Content Collections Demo</h1>
        <p>Demonstrating Astro Content Collections with TypeScript schemas, Zod validation, and type-safe queries.</p>
      </div>
    </section>

    <!-- All Products Section -->
    <section class="demo-section" data-testid="all-products-section">
      <div class="demo-container">
        <h2>All Products ({allProducts.length})</h2>
        <p>All products from the content collection, sorted by priority.</p>

        <div class="product-grid product-grid--3">
          {sortedProducts.map((product) => (
            <article class="product-item" data-testid={`product-${product.slug}`}>
              <ProductCard {...toProductCardProps(product)} />
              <div class="product-meta">
                <span class="product-id">Slug: {product.slug}</span>
                <span class="product-category">Category: {product.data.category}</span>
                {product.data.featured && <span class="badge badge--featured">Featured</span>}
                {product.data.isNew && <span class="badge badge--new">New</span>}
                {product.data.onSale && <span class="badge badge--sale">Sale</span>}
              </div>
            </article>
          ))}
        </div>
      </div>
    </section>

    <!-- Featured Products Section -->
    <section class="demo-section demo-section--alt" data-testid="featured-products-section">
      <div class="demo-container">
        <h2>Featured Products ({featuredProducts.length})</h2>
        <p>Products marked as featured, sorted by priority.</p>

        <div class="product-grid product-grid--3">
          {featuredProducts.map((product) => (
            <article class="product-item" data-testid={`featured-${product.slug}`}>
              <ProductCard {...toProductCardProps(product)} />
              <div class="product-meta">
                <span class="product-tagline">{product.data.tagline}</span>
                <span class="product-price">
                  ${product.data.price.amount.toFixed(2)}
                  {product.data.price.originalAmount && (
                    <span class="original-price">${product.data.price.originalAmount.toFixed(2)}</span>
                  )}
                </span>
              </div>
            </article>
          ))}
        </div>
      </div>
    </section>

    <!-- Category Filter Section -->
    <section class="demo-section" data-testid="category-products-section">
      <div class="demo-container">
        <h2>Kitchen Category ({kitchenProducts.length})</h2>
        <p>Products filtered by the "Kitchen" category.</p>

        {kitchenProducts.length > 0 ? (
          <div class="product-grid product-grid--3">
            {kitchenProducts.map((product) => (
              <article class="product-item" data-testid={`kitchen-${product.slug}`}>
                <ProductCard {...toProductCardProps(product)} />
              </article>
            ))}
          </div>
        ) : (
          <p class="no-products">No kitchen products found.</p>
        )}
      </div>
    </section>

    <!-- Schema Validation Info -->
    <section class="demo-section demo-section--alt" data-testid="schema-info-section">
      <div class="demo-container">
        <h2>Content Collection Schema</h2>
        <p>The products collection uses Zod schemas for validation and type safety.</p>

        <div class="schema-info">
          <h3>Required Fields</h3>
          <ul>
            <li><code>name</code> - Product name/title</li>
            <li><code>price</code> - Price object with amount and currency</li>
            <li><code>description</code> - Brief product description</li>
            <li><code>image</code> - Primary product image with src and alt</li>
            <li><code>category</code> - Product category</li>
            <li><code>shopUrl</code> - External shop URL</li>
          </ul>

          <h3>Optional Fields</h3>
          <ul>
            <li><code>hoverImage</code> - Secondary image for hover effect</li>
            <li><code>tagline</code> - Short promotional text</li>
            <li><code>editorialDescription</code> - Extended description</li>
            <li><code>featured</code>, <code>isNew</code>, <code>onSale</code>, <code>soldOut</code> - Status flags</li>
            <li><code>metadata</code> - SEO and structured data</li>
            <li><code>utmParams</code> - UTM tracking parameters</li>
            <li><code>relatedProducts</code> - Related product slugs</li>
          </ul>

          <h3>Sample Product Data</h3>
          <pre data-testid="sample-data"><code>{JSON.stringify(sortedProducts[0]?.data || {}, null, 2)}</code></pre>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  .demo-page {
    min-height: 100vh;
  }

  .demo-header {
    padding: var(--spacing-16) var(--spacing-4) var(--spacing-12);
    background: linear-gradient(
      135deg,
      var(--color-primary-900) 0%,
      var(--color-primary-700) 100%
    );
    text-align: center;
  }

  .demo-header h1 {
    color: var(--color-text-inverse);
    font-size: var(--font-size-3xl);
    margin-bottom: var(--spacing-4);
  }

  .demo-header p {
    color: var(--color-primary-100);
    font-size: var(--font-size-lg);
    max-width: 40rem;
    margin: 0 auto;
  }

  .demo-container {
    max-width: 80rem;
    margin: 0 auto;
    padding: 0 var(--spacing-4);
  }

  .demo-section {
    padding: var(--spacing-12) 0;
  }

  .demo-section--alt {
    background-color: var(--color-background-subtle);
  }

  .demo-section h2 {
    font-size: var(--font-size-2xl);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-2);
  }

  .demo-section > .demo-container > p {
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-8);
  }

  /* Product Grid */
  .product-grid {
    display: grid;
    gap: var(--spacing-6);
  }

  .product-grid--3 {
    grid-template-columns: repeat(1, 1fr);
  }

  @media (min-width: 640px) {
    .product-grid--3 {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .product-grid--3 {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* Product Meta */
  .product-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
  }

  .product-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-2);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
  }

  .product-id,
  .product-category,
  .product-tagline {
    background: var(--color-background-subtle);
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-sm);
  }

  .product-price {
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
  }

  .original-price {
    text-decoration: line-through;
    color: var(--color-text-secondary);
    margin-left: var(--spacing-2);
  }

  /* Badges */
  .badge {
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
  }

  .badge--featured {
    background: var(--color-primary-100);
    color: var(--color-primary-700);
  }

  .badge--new {
    background: var(--color-success-100);
    color: var(--color-success-700);
  }

  .badge--sale {
    background: var(--color-error-100);
    color: var(--color-error-700);
  }

  /* Schema Info */
  .schema-info {
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-6);
  }

  .schema-info h3 {
    font-size: var(--font-size-lg);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-3);
    margin-top: var(--spacing-4);
  }

  .schema-info h3:first-child {
    margin-top: 0;
  }

  .schema-info ul {
    list-style: disc;
    padding-left: var(--spacing-6);
    color: var(--color-text-secondary);
  }

  .schema-info li {
    margin-bottom: var(--spacing-2);
  }

  .schema-info code {
    background: var(--color-background-subtle);
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-sm);
    font-family: var(--font-family-mono);
    font-size: var(--font-size-sm);
  }

  .schema-info pre {
    background: var(--color-neutral-900);
    color: var(--color-neutral-100);
    padding: var(--spacing-4);
    border-radius: var(--radius-md);
    overflow-x: auto;
    font-size: var(--font-size-xs);
    margin-top: var(--spacing-4);
  }

  .schema-info pre code {
    background: transparent;
    padding: 0;
    color: inherit;
  }

  .no-products {
    padding: var(--spacing-8);
    text-align: center;
    color: var(--color-text-secondary);
    background: var(--color-background-subtle);
    border-radius: var(--radius-lg);
  }
</style>
